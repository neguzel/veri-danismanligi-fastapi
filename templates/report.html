{% extends "base.html" %}
{% block title %}Analiz Sonucu â€“ Veri DanÄ±ÅŸmanlÄ±ÄŸÄ±{% endblock %}

{% block page_title %}Analiz Sonucu{% endblock %}
{% block page_subtitle %}
YÃ¼klediÄŸiniz veri seti iÃ§in otomatik veri kalite analizi, grafikler ve AI destekli rapor Ã¶zeti.
{% endblock %}

{% block content %}

<div class="vd-toolbar" style="margin-bottom:16px; display:flex; justify-content:space-between; gap:8px; flex-wrap:wrap;">
  <div>
    <div class="vd-text-muted">Dosya:</div>
    <div><strong>{{ file_name }}</strong> ({{ file_type|upper }})</div>
    {% if company %}
    <div class="vd-text-muted">Firma: {{ company }}</div>
    {% endif %}
  </div>
  <div style="display:flex; gap:8px; align-items:flex-end;">
    <a href="/download_pdf/{{ upload_id }}" class="vd-btn vd-btn-primary">
      ðŸ“„ PDF Raporu Ä°ndir
    </a>
    <a href="/upload" class="vd-btn vd-btn-ghost">
      â†» Yeni Veri YÃ¼kle
    </a>
  </div>
</div>

<div class="vd-grid vd-grid-3">
  <div class="vd-card">
    <div class="vd-card-body">
      <div class="vd-kpi-label">Veri Kalite Skoru</div>
      <div class="vd-kpi-value">{{ analysis.quality_score }}%</div>
      <div class="vd-kpi-sub">SatÄ±r / Kolon: {{ analysis.rows }} / {{ analysis.cols }}</div>
    </div>
  </div>
  <div class="vd-card">
    <div class="vd-card-body">
      <div class="vd-kpi-label">Toplam HÃ¼cre</div>
      <div class="vd-kpi-value">{{ analysis.total_cells }}</div>
      <div class="vd-kpi-sub">Eksik HÃ¼cre: {{ analysis.total_missing }}</div>
    </div>
  </div>
  <div class="vd-card">
    <div class="vd-card-body">
      <div class="vd-kpi-label">En Kritik Alanlar</div>
      <div class="vd-kpi-sub">En Ã§ok eksik: {{ analysis.top_missing_col or "-" }}</div>
      <div class="vd-kpi-sub">En yÃ¼ksek varyans: {{ analysis.top_var_col or "-" }}</div>
    </div>
  </div>
</div>

<div class="vd-grid vd-grid-2" style="margin-top:20px;">
  <div class="vd-card">
    <div class="vd-card-header">
      <h2 class="vd-card-title">AI Genel Ã–zet</h2>
    </div>
    <div class="vd-card-body">
      <p>{{ ai.summary }}</p>
    </div>
  </div>

  <div class="vd-card">
    <div class="vd-card-header">
      <h2 class="vd-card-title">HÄ±zlÄ± KazanÄ±mlar</h2>
    </div>
    <div class="vd-card-body">
      {% if ai.quick_wins %}
      <ul class="vd-list">
        {% for item in ai.quick_wins %}
        <li>{{ item }}</li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="vd-text-muted">AI henÃ¼z Ã¶neri Ã¼retemedi.</p>
      {% endif %}
    </div>
  </div>
</div>

<div class="vd-grid vd-grid-3" style="margin-top:20px;">
  <div class="vd-card">
    <div class="vd-card-header">
      <h3 class="vd-card-title">Ã–ne Ã‡Ä±kan Ä°Ã§gÃ¶rÃ¼ler</h3>
    </div>
    <div class="vd-card-body">
      {% if ai.key_insights %}
      <ul class="vd-list">
        {% for item in ai.key_insights %}
        <li>{{ item }}</li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="vd-text-muted">Ä°Ã§gÃ¶rÃ¼ listesi boÅŸ.</p>
      {% endif %}
    </div>
  </div>

  <div class="vd-card">
    <div class="vd-card-header">
      <h3 class="vd-card-title">Riskler &amp; Dikkat NoktalarÄ±</h3>
    </div>
    <div class="vd-card-body">
      {% if ai.risks %}
      <ul class="vd-list">
        {% for item in ai.risks %}
        <li>{{ item }}</li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="vd-text-muted">Risk listesi boÅŸ.</p>
      {% endif %}
    </div>
  </div>

  <div class="vd-card">
    <div class="vd-card-header">
      <h3 class="vd-card-title">Ã–nerilen Modeller</h3>
    </div>
    <div class="vd-card-body">
      {% if ai.ml_models %}
      <ul class="vd-list">
        {% for item in ai.ml_models %}
        <li>{{ item }}</li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="vd-text-muted">Model Ã¶nerisi yok.</p>
      {% endif %}
    </div>
  </div>
</div>

{# ----- GRAFÄ°KLER ----- #}
{% if charts and charts|length > 0 %}
<div class="vd-section" style="margin-top:24px;">
  <h2 class="vd-section-title">Grafikler</h2>
  <div class="vd-chart-grid">
    {% for ch in charts %}
    <div class="vd-card vd-chart-card">
      <div class="vd-card-header">
        <h3 class="vd-card-title">{{ ch.title }}</h3>
      </div>
      <div class="vd-card-body">
        <img src="{{ ch.url }}" alt="{{ ch.title }}" class="vd-chart-img">
        {% if ch.description %}
        <p class="vd-text-muted" style="margin-top:6px;">{{ ch.description }}</p>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

{% endblock %}
