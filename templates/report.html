{% extends "base.html" %}
{% block title %}Veri Analiz Raporu â€“ {{ company or "Firma" }}{% endblock %}

{% block page_title %}Veri Analiz Raporu{% endblock %}
{% block page_subtitle %}
{{ company or "Firma" }} iÃ§in otomatik Ã¼retilmiÅŸ veri kalite ve yapay zekÃ¢ analiz Ã¶zeti.
{% endblock %}

{% block content %}

<!-- Ãœst baÅŸlÄ±k satÄ±rÄ±: sol tarafta dosya/firma, saÄŸda PDF butonu -->
<div class="vd-section">
  <div class="vd-grid vd-grid-2" style="align-items:flex-start;gap:16px;">
    <div>
      <div class="vd-meta-line">
        <span class="vd-badge">Dosya</span>
        <span class="vd-meta-value">{{ file_name or "Belirtilmedi" }}</span>
      </div>
      <div class="vd-meta-line">
        <span class="vd-badge">Firma</span>
        <span class="vd-meta-value">{{ company or "Belirtilmedi" }}</span>
      </div>
      <div class="vd-meta-line">
        <span class="vd-badge">Veri Tipi</span>
        <span class="vd-meta-value">{{ file_type|upper }}</span>
      </div>
    </div>

    <div style="text-align:right;">
      {% if upload_id %}
      <a href="/download_pdf/{{ upload_id }}" class="vd-btn vd-btn-primary">
        ğŸ“„ PDF Raporunu Ä°ndir
      </a>
      {% else %}
      <span class="vd-text-muted">PDF iÃ§in yÃ¼kleme ID'si bulunamadÄ±.</span>
      {% endif %}
    </div>
  </div>
</div>

<!-- MÃ¼ÅŸteri bilgileri kartÄ± -->
{% if contact_name or contact_email or contact_phone or contact_sector %}
<div class="vd-section">
  <div class="vd-card">
    <div class="vd-card-header">
      <h2 class="vd-card-title">MÃ¼ÅŸteri / Ä°rtibat Bilgileri</h2>
    </div>
    <div class="vd-card-body">
      <div class="vd-grid vd-grid-2">
        <div>
          <p><strong>Ad Soyad:</strong> {{ contact_name or "-" }}</p>
          <p><strong>Firma:</strong> {{ company or "-" }}</p>
          <p><strong>SektÃ¶r:</strong> {{ contact_sector or "-" }}</p>
        </div>
        <div>
          <p><strong>E-posta:</strong>
            {% if contact_email %}
              <a href="mailto:{{ contact_email }}" class="vd-link">{{ contact_email }}</a>
            {% else %}
              -
            {% endif %}
          </p>
          <p><strong>Cep Telefonu:</strong>
            {% if contact_phone %}
              <a href="tel:{{ contact_phone }}" class="vd-link">{{ contact_phone }}</a>
            {% else %}
              -
            {% endif %}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- KPI kartlarÄ± satÄ±rÄ± -->
<div class="vd-section vd-section-kpi">
  <div class="vd-kpi-row">
    <div class="vd-card vd-card-kpi vd-card-accent">
      <div class="vd-card-header">
        <div class="vd-card-icon">âœ…</div>
        <h3>Veri Kalite Skoru</h3>
      </div>
      <div class="vd-card-body">
        <div class="vd-kpi-value-lg">
          {{ (analysis.quality_score or 0)|round(1) }}%
        </div>
        <div class="vd-kpi-caption">
          Eksik veri oranÄ± dikkate alÄ±narak hesaplanan kalite metriÄŸi.
        </div>
      </div>
    </div>

    <div class="vd-card vd-card-kpi">
      <div class="vd-card-header">
        <div class="vd-card-icon">ğŸ“Š</div>
        <h3>SatÄ±r / Kolon</h3>
      </div>
      <div class="vd-card-body">
        <div class="vd-kpi-value">
          {{ analysis.rows }} / {{ analysis.cols }}
        </div>
        <div class="vd-kpi-caption">
          Toplam hÃ¼cre: {{ analysis.total_cells }}
        </div>
      </div>
    </div>

    <div class="vd-card vd-card-kpi">
      <div class="vd-card-header">
        <div class="vd-card-icon">âš ï¸</div>
        <h3>Eksik HÃ¼cre</h3>
      </div>
      <div class="vd-card-body">
        <div class="vd-kpi-value">
          {{ analysis.total_missing }}
        </div>
        <div class="vd-kpi-caption">
          En Ã§ok eksik alan: {{ analysis.top_missing_col or "-" }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- AI Ã–zet ve Riskler / FÄ±rsatlar -->
<div class="vd-section">
  <div class="vd-grid vd-grid-2">
    <div class="vd-card">
      <div class="vd-card-header">
        <h2 class="vd-card-title">AI Ã–zet</h2>
      </div>
      <div class="vd-card-body">
        {% if analysis.ai_summary %}
          <p>{{ analysis.ai_summary }}</p>
        {% elif ai_comment %}
          <p>{{ ai_comment }}</p>
        {% else %}
          <p>Veri setine iliÅŸkin Ã¶zet bilgisi bulunamadÄ±.</p>
        {% endif %}
      </div>
    </div>

    <div class="vd-card">
      <div class="vd-card-header">
        <h2 class="vd-card-title">Riskler ve Dikkat NoktalarÄ±</h2>
      </div>
      <div class="vd-card-body">
        {% if analysis.ai_risks %}
          <p>{{ analysis.ai_risks }}</p>
        {% else %}
          <p>Belirgin bir risk analizi Ã¼retilmedi veya veri kÄ±sÄ±tlÄ±.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Ã–ne Ã§Ä±kan alanlar & Modeller -->
<div class="vd-section">
  <div class="vd-grid vd-grid-2">
    <div class="vd-card">
      <div class="vd-card-header">
        <h2 class="vd-card-title">Ã–ne Ã‡Ä±kan DeÄŸiÅŸkenler</h2>
      </div>
      <div class="vd-card-body">
        {% if analysis.ai_features %}
          <p>{{ analysis.ai_features }}</p>
        {% else %}
          <p>Ã–ne Ã§Ä±kan Ã¶zellikler hesaplanmadÄ±.</p>
        {% endif %}
      </div>
    </div>

    <div class="vd-card">
      <div class="vd-card-header">
        <h2 class="vd-card-title">Uygulanabilir Model Ã–nerileri</h2>
      </div>
      <div class="vd-card-body">
        {% if analysis.ai_models %}
          <p>{{ analysis.ai_models }}</p>
        {% else %}
          <p>Makine Ã¶ÄŸrenmesi modeli Ã¶nerisi bulunamadÄ±.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Ã–neriler -->
<div class="vd-section">
  <div class="vd-card">
    <div class="vd-card-header">
      <h2 class="vd-card-title">Ä°ÅŸ / Veri GeliÅŸtirme Ã–nerileri</h2>
    </div>
    <div class="vd-card-body">
      {% if analysis.ai_recommendations %}
        <p>{{ analysis.ai_recommendations }}</p>
      {% elif ai_report %}
        <p>{{ ai_report }}</p>
      {% else %}
        <p>Bu veri seti iÃ§in spesifik Ã¶neri Ã¼retilmedi.</p>
      {% endif %}
    </div>
  </div>
</div>

<!-- Grafikler -->
<div class="vd-section">
  <h2 class="vd-section-title">Otomatik Ãœretilen Grafikler</h2>
  {% if charts %}
    <div class="vd-grid vd-grid-2">
      {% for chart in charts %}
      <div class="vd-card">
        <div class="vd-card-header">
          <h3 class="vd-card-title">{{ chart.title or "Grafik" }}</h3>
        </div>
        <div class="vd-card-body">
          <img src="{{ chart.url }}" alt="{{ chart.title }}" class="vd-chart-image"/>
          {% if chart.description %}
            <p class="vd-text-muted" style="margin-top:8px;">{{ chart.description }}</p>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <p>Bu veri seti iÃ§in otomatik grafik Ã¼retilemedi.</p>
  {% endif %}
</div>

<!-- Alt aksiyon barÄ± -->
<div class="vd-section">
  <div class="vd-card">
    <div class="vd-card-body vd-flex vd-flex-between" style="align-items:center;">
      <div>
        <strong>Sonraki adÄ±m:</strong>
        <span class="vd-text-muted">
          Bu raporu PDF olarak indirip ekiplerle paylaÅŸabilir veya yeni bir veri seti yÃ¼kleyebilirsiniz.
        </span>
      </div>
      <div style="display:flex;gap:8px;">
        {% if upload_id %}
        <a href="/download_pdf/{{ upload_id }}" class="vd-btn vd-btn-primary vd-btn-sm">
          ğŸ“„ PDF Ä°ndir
        </a>
        {% endif %}
        <a href="/upload" class="vd-btn vd-btn-ghost vd-btn-sm">
          ğŸ” Yeni Veri YÃ¼kle
        </a>
      </div>
    </div>
  </div>
</div>

{% endblock %}
