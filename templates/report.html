{% extends "base.html" %}
{% block title %}Veri Analiz Raporu â€“ {{ company or "Firma" }}{% endblock %}

{% block page_title %}Veri Analiz Raporu{% endblock %}
{% block page_subtitle %}
{{ company or "Firma" }} iÃ§in otomatik Ã¼retilmiÅŸ veri kalite ve yapay zekÃ¢ analiz Ã¶zeti.
{% endblock %}

{% block content %}

<!-- Ãœst baÅŸlÄ±k satÄ±rÄ±: sol tarafta dosya/firma, saÄŸda PDF butonu -->
<div class="vd-section">
  <div class="vd-grid vd-grid-2" style="align-items:flex-start;gap:16px;">
    <div>
      <div class="vd-meta-line">
        <span class="vd-badge">Dosya</span>
        <span class="vd-meta-value">{{ file_name or "Belirtilmedi" }}</span>
      </div>
      <div class="vd-meta-line">
        <span class="vd-badge">Firma</span>
        <span class="vd-meta-value">{{ company or "Belirtilmedi" }}</span>
      </div>
      <div class="vd-meta-line">
        <span class="vd-badge">Veri Tipi</span>
        <span class="vd-meta-value">{{ file_type|upper }}</span>
      </div>
    </div>

    <div style="text-align:right;">
      {% if upload_id %}
      <a href="/download_pdf/{{ upload_id }}" class="vd-btn vd-btn-primary">
        ğŸ“„ PDF Raporunu Ä°ndir
      </a>
      {% else %}
      <span class="vd-text-muted">PDF iÃ§in yÃ¼kleme ID'si bulunamadÄ±.</span>
      {% endif %}
    </div>
  </div>
</div>

<!-- MÃ¼ÅŸteri bilgileri kartÄ± -->
{% if contact_name or contact_email or contact_phone or contact_sector %}
<div class="vd-section">
  <div class="vd-card">
    <div class="vd-card-header">
      <h2 class="vd-card-title">MÃ¼ÅŸteri / Ä°rtibat Bilgileri</h2>
    </div>
    <div class="vd-card-body">
      <div class="vd-grid vd-grid-2">
        <div>
          <p><strong>Ad Soyad:</strong> {{ contact_name or "-" }}</p>
          <p><strong>Firma:</strong> {{ company or "-" }}</p>
          <p><strong>SektÃ¶r:</strong> {{ contact_sector or "-" }}</p>
        </div>
        <div>
          <p><strong>E-posta:</strong>
            {% if contact_email %}
              <a href="mailto:{{ contact_email }}" class="vd-link">{{ contact_email }}</a>
            {% else %}
              -
            {% endif %}
          </p>
          <p><strong>Cep Telefonu:</strong>
            {% if contact_phone %}
              <a href="tel:{{ contact_phone }}" class="vd-link">{{ contact_phone }}</a>
            {% else %}
              -
            {% endif %}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- KPI kartlarÄ± satÄ±rÄ± -->
<div class="vd-section vd-section-kpi">
  <div class="vd-kpi-row">
    <div class="vd-card vd-card-kpi vd-card-accent">
      <div class="vd-card-header">
        <div class="vd-card-icon">âœ…</div>
        <h3>Veri Kalite Skoru</h3>
      </div>
      <div class="vd-card-body">
        <div class="vd-kpi-value-lg">
          {{ (analysis.quality_score or 0)|round(1) }}%
        </div>
        <div class="vd-kpi-caption">
          Eksik veri oranÄ± dikkate alÄ±narak hesaplanan kalite metriÄŸi.
        </div>
      </div>
    </div>

    <div class="vd-card vd-card-kpi">
      <div class="vd-card-header">
        <div class="vd-card-icon">ğŸ“Š</div>
        <h3>SatÄ±r / Kolon</h3>
      </div>
      <div class="vd-card-body">
        <div class="vd-kpi-value">
          {{ analysis.rows }} / {{ analysis.cols }}
        </div>
        <div class="vd-kpi-caption">
          Toplam hÃ¼cre: {{ analysis.total_cells }}
        </div>
      </div>
    </div>

    <div class="vd-card vd-card-kpi">
      <div class="vd-card-header">
        <div class="vd-card-icon">âš ï¸</div>
        <h3>Eksik HÃ¼cre</h3>
      </div>
      <div class="vd-card-body">
        <div class="vd-kpi-value">
          {{ analysis.total_missing }}
        </div>
        <div class="vd-kpi-caption">
          En Ã§ok eksik alan: {{ analysis.top_missing_col or "-" }}
        </div>
      </div>
    </div>
  </div>
</div>

{% if ai %}
<!-- AI Genel Analiz â€“ Yapay ZekÃ¢ Destekli Ã–zet -->
<div class="vd-section">
  <div class="vd-grid vd-grid-2">
    <section class="vd-card">
      <div class="vd-card-header">
        <h2 class="vd-card-title">AI Genel DeÄŸerlendirme</h2>
      </div>
      <div class="vd-card-body">
        <p>{{ ai.summary }}</p>
      </div>
    </section>

    <section class="vd-card">
      <div class="vd-card-header">
        <h3 class="vd-card-title">Ã–ne Ã‡Ä±kan Ä°Ã§gÃ¶rÃ¼ler</h3>
      </div>
      <div class="vd-card-body">
        <ul>
          {% if ai.key_insights %}
            {% for item in ai.key_insights %}
              <li>{{ item }}</li>
            {% endfor %}
          {% else %}
            <li>Ã–ne Ã§Ä±kan iÃ§gÃ¶rÃ¼ Ã¼retilemedi.</li>
          {% endif %}
        </ul>
      </div>
    </section>
  </div>
</div>

<div class="vd-section">
  <div class="vd-grid vd-grid-2">
    <section class="vd-card">
      <div class="vd-card-header">
        <h3 class="vd-card-title">Riskler</h3>
      </div>
      <div class="vd-card-body">
        <ul>
          {% if ai.risks %}
            {% for item in ai.risks %}
              <li>{{ item }}</li>
            {% endfor %}
          {% else %}
            <li>Belirgin bir risk analizi Ã¼retilemedi veya veri kÄ±sÄ±tlÄ±.</li>
          {% endif %}
        </ul>
      </div>
    </section>

    <section class="vd-card">
      <div class="vd-card-header">
        <h3 class="vd-card-title">HÄ±zlÄ± KazanÄ±mlar</h3>
      </div>
      <div class="vd-card-body">
        <ul>
          {% if ai.quick_wins %}
            {% for item in ai.quick_wins %}
              <li>{{ item }}</li>
            {% endfor %}
          {% else %}
            <li>KÄ±sa vadeli hÄ±zlÄ± kazanÄ±m Ã¶nerisi Ã¼retilemedi.</li>
          {% endif %}
        </ul>
      </div>
    </section>
  </div>
</div>

<div class="vd-section">
  <div class="vd-grid vd-grid-2">
    <section class="vd-card">
      <div class="vd-card-header">
        <h3 class="vd-card-title">Ã–nerilen Modeller</h3>
      </div>
      <div class="vd-card-body">
        <ul>
          {% if ai.ml_models %}
            {% for item in ai.ml_models %}
              <li>{{ item }}</li>
            {% endfor %}
          {% else %}
            <li>Makine Ã¶ÄŸrenmesi modeli Ã¶nerisi bulunamadÄ±.</li>
          {% endif %}
        </ul>
      </div>
    </section>

    <section class="vd-card">
      <div class="vd-card-header">
        <h3 class="vd-card-title">Veri Stratejisi</h3>
      </div>
      <div class="vd-card-body">
        <ul>
          {% if ai.data_strategy %}
            {% for item in ai.data_strategy %}
              <li>{{ item }}</li>
            {% endfor %}
          {% else %}
            <li>Veri stratejisi iÃ§in net aksiyon Ã¶nerisi Ã¼retilemedi.</li>
          {% endif %}
        </ul>
      </div>
    </section>
  </div>
</div>

<div class="vd-section">
  <section class="vd-card">
    <div class="vd-card-header">
      <h3 class="vd-card-title">Yol HaritasÄ±</h3>
    </div>
    <div class="vd-card-body">
      <ol>
        <li>{{ ai.roadmap.phase_1 }}</li>
        <li>{{ ai.roadmap.phase_2 }}</li>
        <li>{{ ai.roadmap.phase_3 }}</li>
      </ol>
    </div>
  </section>
</div>
{% endif %}


<!-- Grafikler -->
<div class="vd-section">
  <h2 class="vd-section-title">Otomatik Ãœretilen Grafikler</h2>
  {% if charts %}
    <div class="vd-grid vd-grid-2">
      {% for chart in charts %}
      <div class="vd-card">
        <div class="vd-card-header">
          <h3 class="vd-card-title">{{ chart.title or "Grafik" }}</h3>
        </div>
        <div class="vd-card-body">
          <img src="{{ chart.url }}" alt="{{ chart.title }}" class="vd-chart-image"/>
          {% if chart.description %}
            <p class="vd-text-muted" style="margin-top:8px;">{{ chart.description }}</p>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <p>Bu veri seti iÃ§in otomatik grafik Ã¼retilemedi.</p>
  {% endif %}
</div>

<!-- Alt aksiyon barÄ± -->
<div class="vd-section">
  <div class="vd-card">
    <div class="vd-card-body vd-flex vd-flex-between" style="align-items:center;">
      <div>
        <strong>Sonraki adÄ±m:</strong>
        <span class="vd-text-muted">
          Bu raporu PDF olarak indirip ekiplerle paylaÅŸabilir veya yeni bir veri seti yÃ¼kleyebilirsiniz.
        </span>
      </div>
      <div style="display:flex;gap:8px;">
        {% if upload_id %}
        <a href="/download_pdf/{{ upload_id }}" class="vd-btn vd-btn-primary vd-btn-sm">
          ğŸ“„ PDF Ä°ndir
        </a>
        {% endif %}
        <a href="/upload" class="vd-btn vd-btn-ghost vd-btn-sm">
          ğŸ” Yeni Veri YÃ¼kle
        </a>
      </div>
    </div>
  </div>
</div>

{% endblock %}
